<c-card class="mt-3">
  <c-card-header class="d-flex justify-content-between">
    <div>{{headerText}}</div>
    <div><button cButton color="primary" shape="rounded-pill" (click)="UserFormView()"><svg cIcon name={{buttonIcon}}></svg> {{BtnText}}</button></div>
  </c-card-header>
  <c-card-body>

  <!-- user form start from here -->
  <c-card class="mt-3 shadow">
      <c-card-body [visible]="visible" cCollapse  class="shadow">
          <form
            #BranchForm="ngForm"
            (submit)="onSubmit(BranchForm)"
            [gutter]="3"
            novalidate
            cForm
            cRow
            class="needs-validation"
          >

          <c-col [md]="4">
            <label cLabel for="office">Office<span class="text-danger">*</span></label>
            <div class="input-wrapper">
              <select (change)="onOfficeSelect(branchService.branchs.officeId)"
                [(ngModel)]="branchService.branchs.officeId" name="officeId" #officeId="ngModel"
                cFormControl id="office" required aria-label="Default select example" cSelect>
                <option [ngValue]="null">Select Office</option>
    
                @for(office of offices; track office.id;let index=$index) {
                <option [value]="office.id">
                  {{ office.name }}
                </option>
                }
              </select>
    
              @if(!officeId.valid && officeId.touched){
              <div class="text-left text-danger">Office is required</div>
              }
            </div>
          </c-col>

          <c-col [md]="4" [hidden]="upperBranchView == false">
            <label cLabel for="upperBranch">Upper Branch<span class="text-danger"></span></label>
            <div class="input-wrapper">
              <select 
                [(ngModel)]="branchService.branchs.upperBranchId" name="upperBranchId" #upperBranch="ngModel"
                cFormControl id="upperBranch" aria-label="Default select example" cSelect>
                <option [ngValue]="null">Select Upper Branch</option>
    
                @for(branch of branches; track branch.id;let index=$index) {
                <option [value]="branch.id">
                  {{ branch.name }}
                </option>
                }
              </select>
    
              @if(upperBranch.value && upperBranch.value == branchId.value){
              <div class="text-left text-danger">Branch and Upper Branch Can't be same</div>
              }
            </div>
          </c-col>

            <c-col [md]="4">
              <input
                type="hidden"
                [(ngModel)]="branchService.branchs.branchId"
                name="branchId" #branchId="ngModel"
              />
              <label cLabel for="validationCustom01"
                >Branch Name<span class="text-danger">*</span></label
              >
              <input
                [(ngModel)]="branchService.branchs.branchName"
                name="branchName" 
                #BranchName="ngModel"
                placeholder="Enter Branch Name"
                cFormControl
                id="validationCustom01"
                required
                type="text"
              />
              @if(!BranchName.valid&&BranchName.touched){
              <div class="text-left text-danger">Branch Name is required</div>
              }
            </c-col>
          
          <c-col [md]="4">
              <label cLabel for="validationCustom02"
              >Branch Name in Bangla<span class="text-danger">*</span></label>
            <input
              [(ngModel)]="branchService.branchs.branchNameBangla"
              name="branchNameBangla" 
              #BranchNameBangla="ngModel"
              placeholder="Enter Branch Name in Bangla"
              cFormControl
              id="validationCustom02"
              required
              type="text"
            />
            @if(!BranchNameBangla.valid&&BranchNameBangla.touched){
            <div class="text-left text-danger">Branch Name in Bangla is required</div>
            }
          </c-col>

          <c-col [md]="4">
            <label cLabel for="validationCustom03"
            >Branch Code<span class="text-danger"></span></label>
          <input
            [(ngModel)]="branchService.branchs.branchCode"
            name="branchCode" 
            #BranchCode="ngModel"
            placeholder="Enter Branch Code"
            cFormControl
            id="validationCustom03"
            type="text"
          />
          @if(!BranchCode.valid&&BranchCode.touched){
          <div class="text-left text-danger">Branch Code is required</div>
          }
        </c-col>

        <c-col [md]="4">
          <label cLabel for="validationCustom04"
          >Phone<span class="text-danger"></span></label>
          <input
            [(ngModel)]="branchService.branchs.phone"
            name="phone" 
            #Phone="ngModel"
            placeholder="Enter Phone Number"
            cFormControl
            id="validationCustom04"
            type="number"
          />
          @if(!Phone.valid&&Phone.touched){
          <div class="text-left text-danger">Phone Number is required</div>
          }
        </c-col>
          <c-col [md]="4">
            <label cLabel for="validationCustom05"
            >Mobile<span class="text-danger"></span></label>
            <input
              [(ngModel)]="branchService.branchs.mobile"
              name="mobile" 
              #Mobile="ngModel"
              placeholder="Enter Mobile Number"
              cFormControl
              id="validationCustom05"
              type="number"
            />
            @if(!Mobile.valid&&Mobile.touched){
            <div class="text-left text-danger">Mobile Number is required</div>
            }
          </c-col>

          
        <c-col [md]="4">
          <label cLabel for="validationCustom13"
          >Email<span class="text-danger">*</span></label>
            <input
              [(ngModel)]="branchService.branchs.email"
              name="email"
              #Email="ngModel"
              placeholder="Enter Email Address"
              cFormControl
              id="validationCustom13"
              required
              type="email"
              pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
            />
            @if(!Email.value&&Email.touched){
            <div class="text-left text-danger">Email is required</div>
            }
            @if(!Email.valid&&Email.touched&&Email.value){
              <div class="text-left text-danger">Email is not valid</div>
              }
          </c-col>
          
        <c-col [md]="4">
          <label cLabel for="validationCustom06"
          >Fax<span class="text-danger"></span></label>
          <input
            [(ngModel)]="branchService.branchs.fax"
            name="fax" 
            #Fax="ngModel"
            placeholder="Enter Fax"
            cFormControl
            id="validationCustom06"
            type="text"
          />
          @if(!Fax.valid&&Fax.touched){
          <div class="text-left text-danger">Fax is required</div>
          }
        </c-col>
          <c-col [md]="4">
            <label cLabel for="validationCustom07"
            >Sqeuence<span class="text-danger"></span></label>
            <input
              [(ngModel)]="branchService.branchs.sequence"
              name="sequence" 
              #Sequence="ngModel"
              placeholder="Enter Sqeuence"
              cFormControl
              id="validationCustom07"
              type="number"
            />
            @if(!Sequence.valid&&Sequence.touched){
            <div class="text-left text-danger">Sequence is required</div>
            }
          </c-col>
          
          <c-col [md]="4">
            <label cLabel for="validationCustom17"
            >Remark<span class="text-danger"></span></label>
          <input
            [(ngModel)]="branchService.branchs.remark"
            name="remark" 
            #Remark="ngModel"
            placeholder="Remark"
            cFormControl
            id="validationCustom17"
            type="text"
          />
        </c-col>
            
    
            <c-col [md]="4">
              <label cLabel for="validationCustom18">Active Status</label>
              <select [(ngModel)]="branchService.branchs.isActive"
              name="isActive"
              cSelect
              id="validationCustom18">
                <option value="true">Active</option>
                <option value="false">De-Active</option>
              </select>
            </c-col>
    
            <c-col [xs]="12">
              <div class="d-flex justify-content-between">
                <div>
                  <button
                    [disabled]="loading"
                    [disabled]="BranchForm.invalid"
                    cButton
                    class="me-1"
                    color="primary"
                    type="submit"
                  >
                    <c-spinner [hidden]="loading == false" size="sm"></c-spinner>
                    {{ btnText }}
                    </button>
                    <button cButton color="secondary" (click)="resetForm()">Reset</button>
                </div>
                <div>
                  <button [hidden]="btnText != 'Update'" cButton color="danger" (click)="cancelUpdate()">Cancel</button>
                </div>
              </div>
            </c-col>
          </form>
      </c-card-body>
    </c-card>
    <!-- user form end here -->
    
    <br/>
    <div class="example-header">
      <mat-form-field>
        <input
          matInput
          #filter
          (keyup)="applyFilter(filter.value)"
          placeholder="Search Here.."
        />
        <button
          mat-icon-button
          matSuffix
          aria-label="clear"
          *ngIf="filter.value"
          (click)="filter.value = ''; applyFilter('')"
        ></button>
      </mat-form-field>
    </div>
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource">
        <ng-container matColumnDef="slNo">
          <th mat-header-cell *matHeaderCellDef>Serial No</th>
          <td mat-cell *matCellDef="let element; let i = index">{{ i + 1 }}</td>
        </ng-container>

        <ng-container matColumnDef="branchName">
          <th mat-header-cell *matHeaderCellDef>Branch Name</th>
          <td mat-cell *matCellDef="let element">
            {{ element.branchName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="branchNameBangla">
          <th mat-header-cell *matHeaderCellDef>Branch Name Bangla</th>
          <td mat-cell *matCellDef="let element">
            {{ element.branchNameBangla }}
          </td>
        </ng-container>

        <ng-container matColumnDef="isActive">
          <th mat-header-cell *matHeaderCellDef>Is Active</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.isActive">Active</span>
            <span *ngIf="!element.isActive">De-Active</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="Action">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let element">
            <button
              class="custom-button" 
              [routerLink]="[
                '/bascisetup/update-officeBranch',
                element.branchId
              ]"
            >
              <svg cIcon name="cilPencil"></svg>
            </button>
            <button class="custom-button" (click)="delete(element)">
              <svg cIcon name="cilTrash"></svg>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </c-card-body>
  <c-card-footer class="text-medium-emphasis">
    <mat-paginator
      appBubblePagination
      [length]="dataSource.data.length"
      [pageSize]="10"
      aria-label="Select page"
    >
    </mat-paginator>
  </c-card-footer>
</c-card>